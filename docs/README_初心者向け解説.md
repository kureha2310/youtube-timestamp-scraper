# 🏭 YouTube歌配信タイムスタンプ工場 - 工場見学ガイド

## ようこそ！この工場は何を作っているの？

**この工場では:** 推しの歌配信で「あの曲いつ歌ってたっけ？」を解決する**曲リスト**を作っています！

YouTubeのコメント欄に散らばってる「6:53 曲名/歌手」みたいなメモを全部集めて、
キレイに整理して、クリックするだけで動画が開くリストに仕上げます。

### 🎯 こんな人が工場を使ってます
- 推しの歌枠で「あの曲いつ歌ってたっけ？」と探すのが大変
- 何回同じ曲歌ってるか知りたい
- ボカロだけ、アニソンだけ聞きたい
- 過去100本の配信を遡るのは無理

---

## 🏭 工場の全体図

この工場には**6つのセクション**があります。
原材料（YouTube動画）が入ってきて、完成品（整理されたリスト）が出ていくまでを見学しましょう！

```
┌─────────────────────────────────────────────────────────────┐
│                    🏭 タイムスタンプ工場                      │
└─────────────────────────────────────────────────────────────┘

 [入口] YouTube動画115本
    ↓
┌──────────────────────────┐
│ 📦 第1セクション: 採掘場  │ ← YouTubeから動画とコメントを掘り出す
└──────────────────────────┘
    ↓ 115本の動画 + 全コメント
┌──────────────────────────┐
│ 🔍 第2セクション: 選別所  │ ← 歌配信だけを選ぶ
└──────────────────────────┘
    ↓ 74本の歌配信
┌──────────────────────────┐
│ 🚿 第3セクション: 洗浄所  │ ← コメントからゴミを除去
└──────────────────────────┘
    ↓ 369個のキレイなタイムスタンプ
┌──────────────────────────┐
│ 🔨 第4セクション: 統合所  │ ← 重複を削除して1つにまとめる
└──────────────────────────┘
    ↓ 210個のユニークなタイムスタンプ
┌──────────────────────────┐
│ 📊 第5セクション: CSV工場 │ ← 表の形にする
└──────────────────────────┘
    ↓ song_timestamps_complete.csv
┌──────────────────────────┐
│ 🎨 第6セクション: 仕分け所│ ← ジャンル別に分ける
└──────────────────────────┘
    ↓
 [出口] 完成品: 3つのジャンル別リスト
    🦉リスト(Vocaloid)
    🦉リスト(アニメ)
    🦉リスト(その他)
```

---

## 🏭 セクション別に見学しよう！

### 📦 第1セクション: YouTube採掘場

**ここでやってること:** YouTubeから動画情報とコメントを掘り出す

```
[作業員の様子]
作業員A: 「チャンネルIDを持ってきて！」
作業員B: 「はい、user_ids.json から読み込みました！」
作業員A: 「YouTube APIに問い合わせ開始！」

YouTube API: 「このチャンネルには115本の動画があるよ」

作業員: 「全部のコメント欄を開けていくぞー！」
    動画1: 【歌枠】今日も歌う！ → コメント53件
    動画2: ゲーム実況 → コメント12件
    動画3: 🎤雑談 → コメント89件
    ...
```

**入ってくるもの:**
- チャンネルID（user_ids.json）
- YouTube API キー

**出てくるもの:**
```
📦 箱の中身:
  [動画1]
    タイトル: 【歌枠】今日も歌う！
    投稿日: 2025/02/04
    コメント: 53件
      "6:53 サイハテ/小林オニキス"
      "いいね！"
      "14:19 アイデンティティ/Kanaria"
      ...

  [動画2]
    タイトル: APEXやるぞ！
    投稿日: 2025/02/05
    コメント: 12件
      "草"
      "ナイス！"
      ...
```

---

### 🔍 第2セクション: 選別所

**ここでやってること:** 歌配信かどうか判定して、歌配信だけを選ぶ

```
[検査員の様子]
検査員: 「さて、この動画は歌配信かな？」

── 動画1を検査中 ──
タイトル: 【歌枠】今日も歌う！
検査員: 「タイトルに『歌枠』って書いてある！OK！」
判定: ✅ 歌配信

── 動画2を検査中 ──
タイトル: APEXやるぞ！
検査員: 「タイトルに歌要素ないな...コメント欄見てみよう」
コメント: 「草」「ナイス！」「GG」
検査員: 「タイムスタンプが全然ない。これはゲーム配信だ」
判定: ❌ 除外

── 動画3を検査中 ──
タイトル: 雑談します
検査員: 「タイトルは歌と関係ないけど...コメント欄を見ると...」
コメント:
  "6:53 サイハテ"
  "14:19 アイデンティティ"
  "20:04 アイラ"
検査員: 「お！タイムスタンプがいっぱいある！これゲリラ歌枠だ！」
判定: ✅ 歌配信
```

**判定基準（検査マニュアル）:**
```
✅ 合格条件（どれか1つでもOK）
  - タイトルに「歌枠」「歌配信」「🎤」がある
  - コメント欄にタイムスタンプが5個以上ある
  - コメント欄の10%以上がタイムスタンプ

❌ 不合格条件
  - タイトルが「APEX」「スプラ」「マイクラ」
  - コメントにタイムスタンプが1個もない
```

**結果:**
```
入荷: 115本
    ↓ 検査中...
合格: 74本（歌配信）
不合格: 41本（ゲーム配信や雑談）
```

---

### 🚿 第3セクション: 洗浄所

**ここでやってること:** コメントについてるゴミを洗い流す

```
[洗浄機の様子]
作業員: 「コメント欄のタイムスタンプ、ゴミだらけだから洗うぞ！」

── 洗浄前 ──
"01. ＆ サイハテ / 小林オニキス feat. 初音ミク"
"②🎵シャルル  /  バルーン  "
"3) メルト - ryo"

[洗浄機スタート！]
ステップ1: 番号を取る
  "01. " → 削除
  "②" → 削除
  "3) " → 削除

ステップ2: 余計な記号を取る
  "＆ " → 削除
  "🎵" → 削除

ステップ3: スペースを整理
  "  /  " → " / "
  "  " → " "

── 洗浄後 ──
✨ "サイハテ / 小林オニキス feat. 初音ミク"
✨ "シャルル / バルーン"
✨ "メルト / ryo"
```

**洗浄機の設定（どんなゴミを除去する？）:**
```
🗑️ 除去するもの:
  - 番号: "01.", "②", "3)"
  - 記号: "＆", "🎵", "♪", "★"
  - 余計なスペース
  - feat., cv., MV などの接頭語

✅ 残すもの:
  - 曲名
  - アーティスト名
  - "feat." とその後の名前（アーティスト情報だから）
```

**結果:**
```
入荷: 74本の動画から見つかったコメント
    ↓ 洗浄中...
洗浄完了: 369個のキレイなタイムスタンプ

例:
  "6:53 サイハテ / 小林オニキス"
  "14:19 アイデンティティ / Kanaria"
  "20:04 アイラ / n-buna"
```

---

### 🔨 第4セクション: 統合所

**ここでやってること:** 同じ曲の重複を1つにまとめる

```
[作業台の様子]
職人: 「同じ曲が3つある...まとめよう」

── 統合前 ──
コメントA: "6:53 サイハテ"
コメントB: "6:55 サイハテ"          ← 2秒しか違わない
コメントC: "6:53 サイハテ/小林オニキス" ← 詳しい情報付き

[職人の判断]
職人: 「タイムスタンプが±5秒以内で、曲名が似てる...これ同じ曲だ」
職人: 「どれを残す？」
    - コメントA: 曲名だけ
    - コメントB: 曲名だけ（タイムスタンプも微妙にズレてる）
    - コメントC: アーティスト名まで書いてある！
職人: 「一番詳しいCを残そう」

── 統合後 ──
✅ "6:53 サイハテ/小林オニキス"
```

**統合ルール（職人のマニュアル）:**
```
同じ曲と判断する条件:
  ✓ 同じ動画内
  ✓ タイムスタンプが±5秒以内
  ✓ 曲名の類似度が80%以上

どれを残す？
  優先度1: アーティスト名まで書いてある
  優先度2: タイムスタンプが正確（秒まで合ってる）
  優先度3: 文字数が多い（詳しい）
```

**結果:**
```
入荷: 369個のタイムスタンプ
    ↓ 統合中...
統合完了: 210個（重複を削除）

削減率: 43%のゴミを除去！
```

---

### 📊 第5セクション: CSV工場

**ここでやってること:** データを表の形に整える

```
[組み立てラインの様子]
作業員: 「さあ、Excelで開ける形にするぞ！」

── 加工前（バラバラのデータ）──
動画ID: abc123
タイトル: 【歌枠】今日も歌う
日付: 2025/02/04
タイムスタンプ: 6:53
曲名: サイハテ
アーティスト: 小林オニキス

[組み立てライン稼働]
作業員A: 「列を作るよ！」
作業員B: 「データを1行ずつ並べるよ！」

── 加工後（CSVファイル）──
┌──────┬─────────┬──────────────┬────────┬──────┬──────────┐
│曲名   │アーティスト│動画タイトル    │配信日   │TS    │動画URL    │
├──────┼─────────┼──────────────┼────────┼──────┼──────────┤
│サイハテ│小林オニキス│【歌枠】今日も..│2025/02/04│6:53  │https://...│
│アイデ..│Kanaria    │【歌枠】今日も..│2025/02/04│14:19 │https://...│
│アイラ  │n-buna     │【歌枠】今日も..│2025/02/04│20:04 │https://...│
└──────┴─────────┴──────────────┴────────┴──────┴──────────┘
```

**ファイルの中身:**
```csv
曲名,アーティスト,動画タイトル,配信日,タイムスタンプ,動画URL,動画ID
サイハテ,小林オニキス,【歌枠】今日も歌う,2025/02/04,6:53,https://youtu.be/abc123?t=413,abc123
アイデンティティ,Kanaria,【歌枠】今日も歌う,2025/02/04,14:19,https://youtu.be/abc123?t=859,abc123
```

**出荷準備完了:**
```
📦 完成品: song_timestamps_complete.csv
   - 210行のデータ
   - Googleスプレッドシートにコピペ可能
   - Excelでも開ける
```

---

### 🎨 第6セクション: 仕分け所（Googleスプレッドシート）

**ここでやってること:** ジャンル別に分けて、リンクを付ける

```
[仕分け作業員の様子]
作業員: 「CSVが届いたぞ！ジャンル別に仕分けるぞ！」

── 仕分け前 ──
曲名: メルト
アーティスト: ryo
配信日: 2025/02/04
タイムスタンプ: 6:53

[仕分け機スタート]
仕分け機: 「アーティスト名を見るよ...」
アーティスト: ryo
仕分け機: 「ボカロPだ！Vocaloid棚に入れよう」

── 仕分け後 ──
✅ 🦉リスト(Vocaloid) に配置

[リンク作成機スタート]
作業員: 「クリックできるリンクを付けるよ！」
タイムスタンプ: 6:53
動画URL: https://youtu.be/abc123
リンク作成: https://youtu.be/abc123?t=413  ← 6:53 = 413秒
作業員: 「完成！クリックすると6:53から再生されるよ」
```

**仕分け基準:**
```
📦 Vocaloid棚に入れるもの:
  - 初音ミク、鏡音リン、KAITO など
  - ボカロP（ryo、wowaka、DECO*27）

📦 アニメ棚に入れるもの:
  - アニメ主題歌
  - 声優名義の曲
  - 「ハレ晴レユカイ」「シルエット」など

📦 その他棚に入れるもの:
  - 上記以外全部
```

**最終出荷:**
```
┌─────────────────────────────────────────────────────┐
│ 🦉リスト(Vocaloid) - 120曲                          │
├────┬───────────┬──────────┬─────────┬─────────┐
│回数│曲名        │アーティスト│配信日1   │TS1      │
├────┼───────────┼──────────┼─────────┼─────────┤
│ 5  │ダダダダ天使│ナナヲアカリ│2025/02/04│🔗0:15:30│ ← クリック
│ 3  │メルト      │ryo       │2025/02/04│🔗1:14:49│    できる！
│ 2  │シャルル    │バルーン   │2025/02/09│🔗2:27:07│
└────┴───────────┴──────────┴─────────┴─────────┘

┌─────────────────────────────────────────────────────┐
│ 🦉リスト(アニメ) - 45曲                             │
├────┬───────────┬──────────┬─────────┬─────────┐
│ 2  │シルエット  │KANA-BOON │2025/02/09│🔗1:59:59│
│ 1  │ハレ晴レユカ│平野綾     │2025/03/01│🔗0:25:30│
└────┴───────────┴──────────┴─────────┴─────────┘

┌─────────────────────────────────────────────────────┐
│ 🦉リスト(その他) - 45曲                             │
├────┬───────────┬──────────┬─────────┬─────────┐
│ 4  │マリーゴールド│あいみょん │2025/02/04│🔗0:04:48│
└────┴───────────┴──────────┴─────────┴─────────┘
```

---

## 🎁 工場の便利機能

### 機能1: **自動検出システム**
タイトルに「歌枠」って書いてなくても、コメント欄を分析して歌配信を見つける

```
タイトル: "雑談します"
    ↓
[AIチェック]
コメント欄:
  "6:53 曲A"
  "14:19 曲B"
  "20:04 曲C"
    ↓
判定: 「ゲリラ歌枠だ！」
```

### 機能2: **重複削除マシン**
同じ曲を何人が書いても、一番詳しいやつだけ残す

```
入力:
  "6:53 サイハテ"           ← 情報少ない
  "6:55 サイハテ"           ← 時間ズレてる
  "6:53 サイハテ/小林オニキス" ← 詳しい！
    ↓
出力:
  "6:53 サイハテ/小林オニキス" のみ
```

### 機能3: **歌唱回数カウンター**
推しが何回同じ曲歌ってるか一目瞭然

```
| 回数 | 曲名            |
|------|----------------|
|  5   | ダダダダ天使    | ← 好きなんだな！
|  3   | メルト          |
|  1   | 新曲試し歌い    |
```

---

## 🎬 工場を実際に動かしてみよう！

### 工場の稼働準備（初回のみ）

工場を動かすには3つの「許可証」が必要です：

```
┌──────────────────────────────┐
│ 📋 工場稼働に必要なもの       │
├──────────────────────────────┤
│ 1. Python                    │ ← 工場の機械を動かすエンジン
│ 2. YouTube API キー           │ ← YouTubeの倉庫に入る許可証
│ 3. Googleスプレッドシート      │ ← 完成品を並べる棚
└──────────────────────────────┘
```

---

### 🏭 工場の稼働ボタンを押す

#### ステップ1: 工場を起動する

```bash
# コマンドプロンプト（工場の制御パネル）で入力
python src/extractors/youtube_song_scraper.py
```

**制御パネルの表示:**
```
🏭 タイムスタンプ工場 起動
============================================================

[第1セクション: 採掘場] 起動中...
YouTube倉庫からデータ取得中...
全動画数: 115本を発見

[第2セクション: 選別所] 起動中...
歌配信を選別中...
✅ 合格: 74本
❌ 不合格: 41本

[第3セクション: 洗浄所] 起動中...
コメントを取得中...
1/74: 【#歌枠】今日も歌うよ～ → コメント53件
2/74: 【歌配信】リクエストに... → コメント89件
3/74: 雑談します → コメント42件
...

[第4セクション: 統合所] 起動中...
タイムスタンプ抽出中...
抽出数: 369個

[第5セクション: CSV工場] 起動中...
重複削除中...
統合後: 210個

出荷準備完了！
📦 song_timestamps_complete.csv を生成しました

[工場統計]
   - 処理した動画: 74本
   - 抽出したタイムスタンプ: 369個
   - 最終製品数: 210個
   - 削減率: 43%
```

---

#### ステップ2: 完成品を棚に並べる

```
[📦 出荷準備]
1. song_timestamps_complete.csv を開く
2. 全部選択（Ctrl+A）してコピー（Ctrl+C）
3. Googleスプレッドシートの「リスト(一覧)」シートに貼り付け

    [出荷トラック]
    🚚 → 📋 Googleスプレッドシート
```

---

#### ステップ3: ジャンル別に仕分け（第6セクション起動）

```
[🎨 第6セクション: 仕分け所] 起動手順

1. Googleスプレッドシートを開く
2. メニュー「拡張機能」→「Apps Script」をクリック
3. 仕分け機のプログラムをコピペ
4. 実行ボタン（▶️）を押す

[仕分け機 稼働中...]
🔄 Vocaloid棚に振り分け中... 120曲
🔄 アニメ棚に振り分け中... 45曲
🔄 その他棚に振り分け中... 45曲

✅ 完了！3つの棚が完成しました
```

---

## 🎯 完成品の使い方

### 使用例1: 「あの曲いつ歌ってた？」

```
[🔍 検索モード]

1. 🦉リスト(Vocaloid) を開く
2. Ctrl+F で検索窓を開く
3. 「メルト」と入力

[検索結果]
┌────┬──────┬──────────┬─────────┬─────────┐
│回数│曲名   │アーティスト│配信日1   │TS1      │
├────┼──────┼──────────┼─────────┼─────────┤
│ 3  │メルト │ryo       │2025/02/04│🔗1:14:49│
│    │      │          │2025/03/17│🔗0:45:30│
│    │      │          │2025/05/10│🔗2:03:15│
└────┴──────┴──────────┴─────────┴─────────┘

🔗 リンクをクリック
    ↓
📺 YouTubeが開いて、1:14:49から再生開始！
```

---

### 使用例2: 「何回この曲歌ってる？」

```
[📊 統計モード]

1. 「回数」列をクリック
2. ソート（並べ替え）

[ランキング結果]
┌────┬────────────┬──────────┐
│順位 │曲名         │回数      │
├────┼────────────┼──────────┤
│ 1位 │ダダダダ天使 │ 5回      │ ← 推しのお気に入り！
│ 2位 │メルト       │ 3回      │
│ 3位 │シャルル     │ 3回      │
│ 4位 │アイデンティ │ 2回      │
└────┴────────────┴──────────┘
```

---

### 使用例3: 「ボカロだけ聞きたい」

```
[📂 棚を開く]

🦉リスト(Vocaloid) を開く
    ↓
┌──────────────────────────────┐
│ ボカロだけがまとまってる！    │
├──────────────────────────────┤
│ メルト                       │
│ シャルル                     │
│ ローリンガール                │
│ ワールドイズマイン            │
│ 千本桜                       │
└──────────────────────────────┘

上から順にクリックして聞くだけ！
```

---

## 🤔 工場長に質問コーナー

**Q: 機械の操作分からないんだけど...**
A: 最初のセットアップだけ頑張れば、あとはボタン押すだけです！工場は全自動！

**Q: 工場の稼働費用かかる？**
A: 基本無料！YouTube APIは1日10,000回まで無料（個人使用なら十分）

**Q: 他のチャンネルの製品も作れる？**
A: はい！`user_ids.json`（材料リスト）に好きなチャンネルIDを入れるだけ

**Q: どれくらいの量まで処理できる？**
A: Googleスプレッドシートの上限（1シート500万セル）まで大丈夫

**Q: データが壊れたら？**
A: 自動バックアップ（`comment_info.json`）があるので復元できます

**Q: 工場の処理速度は？**
A: 100本の動画なら約5分で完成品ができます

---

## 🔧 工場のカスタマイズ

### カスタマイズ1: 棚を増やす

```
[デフォルト]
  🦉リスト(Vocaloid)
  🦉リスト(アニメ)
  🦉リスト(その他)

[カスタマイズ後]
  🦉リスト(Vocaloid)
  🦉リスト(アニメ)
  🦉リスト(J-POP)    ← 追加
  🦉リスト(洋楽)      ← 追加
  🦉リスト(その他)
```

設定ファイルのジャンルリストに追加するだけ！

---

### カスタマイズ2: 除外ワードを設定

```
[問題]
ゲーム配信中のBGMまで拾ってしまう...

[解決]
除外キーワードを追加
  "APEX", "スプラ", "マイクラ", "ポケモン"

[結果]
✅ ゲーム配信は自動でスキップされる
```

---

## 🎁 工場のスペシャル機能

### 機能1: 確度スコア
```
工場が「これ本当に歌配信？」って判定してくれる

0.9 = ほぼ確実 → 安心して製造
0.7 = たぶん → 一応製造
0.5 = 微妙... → BGMだけかも
0.3 = 怪しい → スキップ
```

### 機能2: ひらがな検索対応
```
検索: 「まりーごーるど」
    ↓
ヒット: 「マリーゴールド」「mariーgold」も見つかる！
```

### 機能3: 自動バックアップ
```
工場が稼働するたびに:
  📦 comment_info.json （コメント生データ）
  📦 song_timestamps_complete.csv （完成品）
両方を自動保存！
```

---

## 🎉 完成品イメージ

工場が完成させる最終製品はこんな感じ：

```
┌──────────────────────────────────────────────────┐
│ 🦉リスト(Vocaloid) - 120曲                       │
├────┬─────────┬─────────┬────────┬────────┐
│回数│曲名      │アーティスト│配信日1  │TS1     │
├────┼─────────┼─────────┼────────┼────────┤
│ 5  │ダダダダ天使│ナナヲアカリ│02/04   │🔗0:15  │ ← クリック！
│ 3  │メルト    │ryo      │02/04   │🔗1:14  │
│ 3  │シャルル  │バルーン  │02/09   │🔗2:27  │
│ 2  │ローリンガ│wowaka   │02/04   │🔗1:06  │
└────┴─────────┴─────────┴────────┴────────┘

[特徴]
✓ ジャンル別に整理済み
✓ クリックで動画が開く
✓ 歌唱回数がすぐ分かる
✓ 配信日で時系列も追える
```

---

## 📚 もっと詳しい設計図が見たい人へ

工場の内部構造や技術仕様は別のマニュアルに：
→ `README_システム解説.md`

こんなことが書いてあります：
- 各セクションの詳細なアルゴリズム
- データフロー図
- トラブルシューティング
- 関数の技術仕様

---

## 👋 工場見学ツアー終了！

お疲れ様でした！この工場で、推しの歌配信を快適に楽しんでください！

**工場を改善したい？**
- GitHubでスター⭐
- 改善案をIssueで報告
- バグを見つけたら教えてください

**工場長より: Happy Singing! 🎤✨**
