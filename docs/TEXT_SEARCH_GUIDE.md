# YouTubeチャンネル内 文字列検索ツール 使い方ガイド

## 概要

このツールは、指定したYouTubeチャンネルの動画から特定の文字列を検索し、その出現箇所とタイミングをまとめることができます。

### 検索対象

- **コメント**: 動画に投稿されたコメント
- **字幕**: 動画の字幕（自動生成含む）
- **ライブチャット**: ライブ配信のチャット（実装準備中）

## インストール

### 前提条件

1. Python 3.7以上
2. YouTube Data API v3 キー

### 依存パッケージのインストール

```bash
pip install -r config/requirements.txt
```

字幕検索を使用する場合は、追加で以下をインストール:

```bash
pip install youtube-transcript-api
```

### API キーの設定

プロジェクトルートに `.env` ファイルを作成し、以下を記入:

```
API_KEY=your_youtube_api_key_here
```

## 使い方

### 方法1: 対話モード（推奨）

ターミナルでプロジェクトルートに移動し、以下を実行:

```bash
python search_text.py
```

その後、画面の指示に従って以下を入力:

1. **チャンネルID**: 検索対象のYouTubeチャンネルID
2. **検索文字列**: 探したい文字列（例: "特定の曲名", "用語", "フレーズ"）
3. **検索対象**: コメント、字幕、またはその両方
4. **検索動画数**: 何本の動画を検索するか（推奨: 50）

#### 例

```
チャンネルIDを入力してください:
> UCxxxxxxxxxxxxxxxxxxxxxx

検索する文字列を入力してください:
> 夜に駆ける

検索対象を選択してください:
1. コメント
2. 字幕
3. コメント + 字幕 (推奨)
4. すべて (コメント + 字幕 + ライブチャット)
> 3

検索する動画数を入力してください:
> 50
```

### 方法2: コマンドライン引数モード

直接コマンドラインから実行:

```bash
python search_text.py <チャンネルID> "検索文字列" [オプション]
```

#### オプション

| オプション | 説明 |
|-----------|------|
| `--comments` | コメントのみ検索 |
| `--transcripts` | 字幕のみ検索 |
| `--all` | コメント + 字幕を検索（デフォルト） |
| `--max-videos N` | 検索する動画数を指定（デフォルト: 50） |

#### 例

```bash
# コメントと字幕から100本の動画を検索
python search_text.py UCxxxxxx "夜に駆ける" --all --max-videos 100

# コメントのみから検索
python search_text.py UCxxxxxx "特定の用語" --comments

# 字幕のみから検索
python search_text.py UCxxxxxx "フレーズ" --transcripts
```

## 出力形式

### CSV出力

結果は `output/csv/search_results_YYYYMMDD_HHMMSS.csv` に保存されます。

#### 出力例

| No | 動画タイトル | 動画ID | 公開日 | 検索元 | タイムスタンプ | 検索文字列 | コンテキスト | 動画URL |
|----|------------|--------|--------|--------|------------|-----------|------------|---------|
| 1 | 歌枠配信 #1 | abc123 | 2025/01/15 | コメント | 5:42 | 夜に駆ける | 「5:42 夜に駆ける / YOASOBI」 | https://youtube.com/watch?v=abc123&t=342 |
| 2 | ライブ配信 | def456 | 2025/02/20 | 字幕 | 12:30 | 夜に駆ける | 次は夜に駆けるを歌います | https://youtube.com/watch?v=def456&t=750 |

### 統計情報

実行後、以下の統計情報が表示されます:

- **検索元別**: コメント、字幕それぞれのヒット数
- **動画別ヒット数**: 最もヒットが多かった動画トップ5

#### 統計表示例

```
======================================================================
[*] 検索結果統計
======================================================================

検索元別:
   コメント: 25件
   字幕: 12件

動画別ヒット数 (上位5件):
   歌枠配信 #15... (8件)
   カラオケ配信 2025/01/20... (5件)
   歌ってみた枠... (4件)
======================================================================
```

## よくある質問

### Q1. チャンネルIDの調べ方は？

**方法1: チャンネルページのURLから**

チャンネルページのURLが以下の形式の場合:
- `https://www.youtube.com/channel/UCxxxxxxxxxxxxxxxxxxxxxx`

`UCxxxxxxxxxxxxxxxxxxxxxx` の部分がチャンネルIDです。

**方法2: カスタムURLの場合**

チャンネルページのソースコードを表示して、`"channelId"` で検索してください。

### Q2. 検索結果が見つからない

以下を確認してください:

1. **検索文字列が正しいか**: 大文字小文字は区別されません
2. **検索対象を広げる**: コメントのみでなく、字幕も含めて検索
3. **検索動画数を増やす**: 50本→100本など

### Q3. API制限エラーが出る

YouTube Data API v3には1日の利用制限があります:

- **無料枠**: 10,000ユニット/日
- **消費量**: 動画リスト取得(1) + コメント取得(1/動画) ≈ 51ユニット（50本の動画を検索する場合）

大量の動画を検索する場合は、日をまたいで実行してください。

### Q4. 字幕が見つからない

字幕が利用できない動画もあります:

- 字幕がアップロードされていない
- 自動字幕が生成されていない
- プライベート動画

コメント検索と併用することをおすすめします。

### Q5. ライブチャットは検索できますか？

現在、ライブチャットの検索機能は準備中です。将来のバージョンで対応予定です。

## 技術仕様

### 検索の仕組み

1. **チャンネル動画取得**: YouTube Data API v3でチャンネルの動画リストを取得
2. **各動画の検索**:
   - コメント: API経由でコメントを取得して検索
   - 字幕: youtube-transcript-api で字幕を取得して検索
3. **タイムスタンプ抽出**: コメント内のタイムスタンプ（MM:SS, HH:MM:SS）を自動抽出
4. **結果の集約**: すべてのヒットをCSVに出力

### 処理速度

- **50本の動画**: 約5-10分
- **100本の動画**: 約10-20分

※ネットワーク速度とAPI応答時間に依存

### 制限事項

- ライブチャット検索は未実装
- 非常に大量のコメント（1000件以上）がある動画は一部のみ検索
- プライベート動画やメンバー限定動画は検索不可

## トラブルシューティング

### エラー: "API_KEY が設定されていません"

`.env` ファイルが正しく作成されているか確認してください。

```bash
# .env ファイルの確認
cat .env

# 出力例
API_KEY=your_api_key_here
```

### エラー: "youtube-transcript-api not installed"

字幕検索機能を使うには、追加パッケージが必要です:

```bash
pip install youtube-transcript-api
```

### エラー: "HttpError 403"

API キーが無効、または API 制限に達しています。

1. API キーを確認
2. Google Cloud Console で YouTube Data API v3 が有効になっているか確認
3. API クォータを確認

## サポート

問題が解決しない場合は、以下を添えて Issue を作成してください:

- エラーメッセージ全文
- 実行したコマンド
- Python バージョン (`python --version`)
- OS 情報

## ライセンス

MIT License
