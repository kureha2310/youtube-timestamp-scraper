# 指示履歴の記録ガイド - YouTube Timestamp Scraper

**読了時間**: 約15分
**対象者**: このプロジェクトでClaude Codeと協働開発する人
**最終更新**: 2025-12-08

---

## 🎯 なぜ記録するのか？

AIとの協働開発で「記録」を取ることには、**3つの大きなメリット**があります。

### メリット1: 再現性の向上

**問題**:
```
あなた: 「前回どうやったっけ？」
あなた: 「あの指示、もう一度やりたいけど忘れた...」
```

**解決**:
```
docs/instructions/20251203_selectbox_deploy.md を見れば:
- 使った指示が全部残っている
- Task toolの使い方も記録されている
- 成功パターンをコピペで再利用できる
```

---

### メリット2: 効果の検証

**問題**:
```
あなた: 「Task tool使うと本当に速くなるの？」
あなた: 「トークン消費が気になる...」
```

**解決**:
```
cost.csv を見れば:
- Task tool活用前: 3.5時間、200K tokens、$3.00
- Task tool活用後: 1.2時間、120K tokens、$1.80
→ 数字で効果を実感できる
```

---

### メリット3: チーム内での共有

**問題**:
```
チームメンバー: 「どうやって実装したの？」
あなた: 「えーと、確か...（説明に30分）」
```

**解決**:
```
docs/instructions/20251203_selectbox_deploy.md を共有:
- 指示内容が全部書いてある
- ハマったポイントも記録されている
- 次の人が同じ失敗をしない
```

---

## 📁 ディレクトリ構成

```
docs/
├── instructions/          # 指示履歴（日々の作業記録）
│   ├── 20251208_genre_classification_improvement.md
│   ├── 20251209_logging_system_implementation.md
│   └── 20251210_database_migration_plan.md
│
├── metrics/              # 定量データ
│   ├── cost.csv          # トークン消費ログ
│   └── weekly_review.md  # 週次レビュー
│
└── explorations/         # 探索結果（Task tool の出力）
    ├── 20251208_existing_scraper_patterns.md
    └── 20251209_error_handling_analysis.md
```

---

## 📝 指示履歴のテンプレート

### テンプレート: `docs/instructions/YYYYMMDD_[topic].md`

```markdown
# [タスク名] - 指示履歴

## 📋 基本情報
- **日時**: 2025-12-08 10:00 - 12:30
- **目的**: [タスクの目的を一言で]
- **関連Issue**: #123（ある場合）
- **担当者**: [あなたの名前]

## 🎯 最終ゴール
[このタスクで達成したいことを具体的に記述]

例:
- SelectBoxコンポーネントを全画面（20ファイル）に展開
- 既存のSelectBox実装パターンを完全に踏襲
- ビルドエラーゼロで完了

## 📊 定量目標
- 対象ファイル: 約20ファイル
- 所要時間: 3時間以内
- トークン消費: 150K以内
- 変更行数: 約500行

---

## 🔄 作業フロー

### Phase 1: 探索（10:00 - 10:12）

**指示内容**:
\`\`\`markdown
Task tool (Explore agent, very thorough) で以下を調査:
- 既存のSelectBox実装箇所を全て洗い出し
- 各実装のパターン分類
- 置き換え対象の優先度評価

調査結果は docs/explorations/20251203_selectbox.md に保存してください。
\`\`\`

**実行結果**:
- 実行時刻: 10:00 - 10:12（12分）
- 消費トークン: 28,000
- 成果物: docs/explorations/20251203_selectbox.md
- 発見: 既存実装23箇所、うち3箇所は共通化済み

**振り返り**:
- ✅ Explore agentで見落としが減った
- ✅ 23箇所すべてを正確に抽出
- ⚠️ SettingsPageが想定外に複雑（カスタムスタイルあり）

---

### Phase 2: 計画（10:12 - 10:27）

**指示内容**:
\`\`\`markdown
Task tool (Plan agent) で以下を立案:
- Phase 1の結果をもとに、実装計画を作成
- 変更が必要なファイルリスト
- 実装ステップ（段階的に）
- リスクと対策

計画を報告後、承認を得てから実装に進んでください。
\`\`\`

**実行結果**:
- 実行時刻: 10:12 - 10:27（15分）
- 消費トークン: 22,000
- 提案: 3つのグループに分けて並列実装
  - グループA: シンプルな置き換え（12ファイル）
  - グループB: カスタムスタイルあり（8ファイル）
  - グループC: 複雑なロジック（3ファイル）

**振り返り**:
- ✅ リスク「SettingsPageのカスタムスタイル」を事前把握
- ✅ 並列実装の提案で時間短縮見込み

**承認**: ✅ 計画承認（10:27）

---

### Phase 3: 実装（10:27 - 12:05）

**指示内容**:
\`\`\`markdown
以下3つを並列実行:

【Task 1】グループA対応（Sonnet）
対象: UserList.tsx, Dashboard.tsx など12ファイル
指示: 既存の components/common/SelectBox.tsx のパターンを完全に踏襲。
propsの型定義、スタイル、エラーハンドリングをすべて同じにする。

【Task 2】グループB対応（Sonnet）
対象: SettingsPage.tsx など8ファイル
指示: 既存パターン踏襲に加え、カスタムスタイルを維持する。

【Task 3】グループC対応（Sonnet）
対象: AdminPanel.tsx など3ファイル
指示: 複雑なロジックを慎重に移植。テストコードも合わせて修正。
\`\`\`

**実行結果**:
- 実行時刻: 10:27 - 12:05（1時間38分）
- 消費トークン: 89,000
- Task 1: 完了（50分、35K tokens）
- Task 2: 完了（55分、38K tokens）
- Task 3: 完了（53分、16K tokens）← Haikuで十分だった

**振り返り**:
- ✅ 並列実行で時間大幅短縮（予想3時間 → 実績1.6時間）
- ✅ 見落としゼロ
- ⚠️ Task 3はHaikuで十分だった（次回はコスト削減可能）

---

### Phase 4: 統合確認（12:05 - 12:15）

**指示内容**:
\`\`\`markdown
以下を確認してください:
1. npm run build でビルド成功
2. 各画面で動作確認
3. テスト実行: npm test
\`\`\`

**実行結果**:
- 実行時刻: 12:05 - 12:15（10分）
- ビルド: ✅ 成功
- 動作確認: ✅ 全画面OK
- テスト: ✅ All tests passed

**振り返り**:
- ✅ 一発でビルド成功
- ✅ バグゼロ

---

## 📊 定量結果

### トークン消費

| Phase | 予想 | 実績 | 差分 |
|-------|------|------|------|
| Phase 1: 探索 | 30K | 28K | -7% |
| Phase 2: 計画 | 25K | 22K | -12% |
| Phase 3: 実装 | 90K | 89K | -1% |
| Phase 4: 確認 | 5K | 5K | 0% |
| **合計** | **150K** | **144K** | **-4%** |

### 時間

| Phase | 予想 | 実績 | 差分 |
|-------|------|------|------|
| Phase 1: 探索 | 15分 | 12分 | -20% |
| Phase 2: 計画 | 20分 | 15分 | -25% |
| Phase 3: 実装 | 3時間 | 1時間38分 | **-45%** |
| Phase 4: 確認 | 10分 | 10分 | 0% |
| **合計** | **3時間45分** | **2時間15分** | **-40%** |

### コスト

- 予想: $2.25（150K tokens × $0.015/1K）
- 実績: $2.16（144K tokens × $0.015/1K）
- 削減: **-4%**

### 変更ファイル数

- 予想: 20ファイル
- 実績: 23ファイル（+3ファイル発見）

### バグ数

- 予想: 2-3個
- 実績: **0個**

---

## 💡 学びと改善点

### Keep（継続すること）

1. **Explore agent（very thorough）の活用**
   - 見落としが激減（23箇所すべて発見）
   - 事前のリスク把握で手戻りゼロ

2. **並列実行の活用**
   - 3時間 → 1.6時間に短縮（-47%）
   - トークン消費はほぼ変わらず

3. **Plan agentでの事前計画**
   - リスク「SettingsPageのカスタムスタイル」を事前把握
   - 段階的な実装で安心

### Problem（改善が必要だったこと）

1. **Task 3でSonnetを使った**
   - 実際はHaikuで十分だった
   - 次回は簡単なタスクはHaikuを指定

2. **CSSクラス名の変更漏れ**
   - SelectBoxの内部クラス名が変わっていた
   - 次回はCSSも事前調査に含める

### Try（次回への改善策）

1. **Explore agentでCSSも洗い出す**
   ```markdown
   Task tool (Explore agent, very thorough) で:
   - 既存のSelectBox実装箇所を全て洗い出し
   - **CSSクラス名の使用箇所も洗い出し** ← 追加
   ```

2. **簡単なタスクはHaikuを明示**
   ```markdown
   【Task 3】グループC対応（Haiku）← Sonnetではなく
   ```

3. **propsの互換性チェックリスト作成**
   - 次回の同様タスクで使えるチェックリストを作成
   - docs/checklists/component_replacement.md

---

## 📎 関連ファイル

- **探索結果**: [docs/explorations/20251203_selectbox.md](../explorations/20251203_selectbox.md)
- **修正したファイル**: 23ファイル（リストは省略）
- **コミット**: `abc123f` - SelectBoxを全画面に展開

---

## 📅 次回のアクション

- [ ] propsの互換性チェックリストを作成
- [ ] CSSクラス名の調査を標準フローに追加
- [ ] 週次レビューでこの経験を共有

---

**作成日**: 2025-12-03
**次回レビュー**: 2025-12-10（週次レビュー時）
```

---

## 📊 cost.csv のフォーマット

### ファイル: `docs/metrics/cost.csv`

```csv
日付,タスク名,手法,トークン消費,時間(h),変更ファイル数,コスト($),備考
2025-12-03,SelectBox全展開,Task tool,144000,2.25,23,2.16,Explore+Plan+並列実装
2025-12-04,ジャンル分類改善,Task tool,95000,1.5,12,1.43,genre_keywords.json拡充
2025-12-05,バグ修正（YOASOBI誤分類）,直接指示,3000,0.08,1,0.05,単純なバグは直接の方が速い
2025-12-06,ロギング機構導入,Task tool,120000,2.0,8,1.80,Explore+Plan+実装
2025-12-08,プロジェクト改善ドキュメント作成,Task tool + 直接実装,61000,1.5,4,0.92,claude.md等4ファイル作成
```

### 列の説明

| 列名 | 説明 | 例 |
|------|------|-----|
| 日付 | タスク実施日（YYYY-MM-DD） | 2025-12-03 |
| タスク名 | タスクの簡潔な名前 | SelectBox全展開 |
| 手法 | Task tool / 直接指示 | Task tool |
| トークン消費 | 消費したトークン数 | 144000 |
| 時間(h) | 実際にかかった時間（小数点2桁） | 2.25 |
| 変更ファイル数 | 修正したファイル数 | 23 |
| コスト($) | トークン消費 × 単価 | 2.16 |
| 備考 | 特記事項、使ったagentなど | Explore+Plan+並列実装 |

### トークン単価の計算

**Claude Sonnet 4.5 の料金** (2025年12月時点):
- Input: $3.00 / 1M tokens
- Output: $15.00 / 1M tokens

**簡易計算** (Input:Output = 7:3 と仮定):
- 平均単価: $3.00 × 0.7 + $15.00 × 0.3 = $6.60 / 1M tokens
- 1K tokens あたり: **$0.0066**

**計算例**:
```
144,000 tokens × $0.0066 / 1K = $0.95
```

---

## 📅 週次レビューのテンプレート

### テンプレート: `docs/metrics/weekly_review.md`

```markdown
# 週次レビュー - 2025年12月第1週

**期間**: 2025-12-01（月） - 2025-12-07（日）
**レビュー日**: 2025-12-08

---

## 📊 今週の実績

### 定量データ

| 指標 | 今週 | 先週 | 増減 |
|------|------|------|------|
| タスク数 | 5個 | 7個 | -29% |
| 総時間 | 6.0h | 9.5h | **-37%** |
| トークン消費 | 342K | 450K | **-24%** |
| コスト | $2.26 | $2.97 | **-24%** |
| 変更ファイル数 | 48ファイル | 62ファイル | -23% |
| バグ数 | 1個 | 3個 | **-67%** |

### タスク別内訳

| 日付 | タスク名 | 手法 | トークン | 時間 | コスト |
|------|---------|------|---------|------|-------|
| 12/03 | SelectBox全展開 | Task tool | 144K | 2.25h | $0.95 |
| 12/04 | ジャンル分類改善 | Task tool | 95K | 1.5h | $0.63 |
| 12/05 | バグ修正 | 直接指示 | 3K | 0.08h | $0.02 |
| 12/06 | ロギング機構導入 | Task tool | 120K | 2.0h | $0.79 |
| 12/08 | ドキュメント作成 | 混合 | 61K | 1.5h | $0.40 |

---

## 💡 今週の学び

### Keep（継続すること）

1. **並列実行の活用**
   - SelectBox全展開で時間-47%削減
   - 3つ以上の独立タスクは必ず並列化

2. **Explore agent（very thorough）の活用**
   - 見落としが激減
   - 事前のリスク把握で手戻りゼロ

3. **単純なバグは直接指示**
   - 3K tokens、5分で完了
   - Task toolのオーバーヘッドが無駄

### Problem（改善が必要だったこと）

1. **CSSクラス名の確認漏れ**
   - SelectBox展開時にCSSの調査が不足
   - 次回はExplore agentでCSSも調査

2. **Sonnet vs Haiku の選択ミス**
   - 簡単なタスクにSonnetを使ってコスト増
   - 次回は明示的にHaikuを指定

3. **ジャンル分類の辞書不足**
   - genre_keywords.json の拡充が必要
   - 主要アーティスト500組を目標

### Try（次回への改善策）

1. **Explore agentでCSSも洗い出す**
   - 標準の探索指示にCSSクラス名調査を追加

2. **簡単なタスクはHaikuを明示**
   - テスト追加、単純な修正はHaikuで十分

3. **propsの互換性チェックリスト作成**
   - コンポーネント置き換え時のチェックリスト
   - docs/checklists/component_replacement.md

---

## 📈 累積データ（月次）

### 12月の累積（第1週まで）

| 指標 | 累積 | 目標（月次） | 達成率 |
|------|------|------------|--------|
| タスク数 | 5個 | 20個 | 25% |
| 総時間 | 6.0h | 30h | 20% |
| トークン消費 | 342K | 1.5M | 23% |
| コスト | $2.26 | $10.00 | 23% |

**進捗**: 順調（週1ペースでタスク消化中）

---

## 🎯 来週の目標

### 計画中のタスク

1. **テストカバレッジの向上**
   - 優先度: 🟡 中
   - 見積もり: 8時間
   - 目標: ユニットテスト70%以上

2. **差分更新の信頼性向上**
   - 優先度: 🔴 高
   - 見積もり: 2時間
   - 目標: チャンネル単位の進捗管理

3. **バージョン管理の整理**
   - 優先度: 🔴 高
   - 見積もり: 1時間
   - 目標: 自動バックアップの仕組み化

### 重点課題

- Task tool（Explore + Plan）の活用を継続
- 並列実行で時間短縮を狙う
- Haiku活用でコスト削減

---

## 📝 メモ

- 今週は効率が大幅に向上（時間-37%、コスト-24%）
- Task toolの活用が効果的だった
- 来週も同じパターンを継続

---

**次回レビュー**: 2025-12-15（日）
```

---

## 🚀 記録の始め方（3ステップ）

### Step 1: ディレクトリを作成

```bash
mkdir -p docs/instructions
mkdir -p docs/metrics
mkdir -p docs/explorations
```

または、Windowsの場合:
```cmd
mkdir docs\instructions
mkdir docs\metrics
mkdir docs\explorations
```

---

### Step 2: cost.csv を作成

`docs/metrics/cost.csv` を作成:

```csv
日付,タスク名,手法,トークン消費,時間(h),変更ファイル数,コスト($),備考
```

---

### Step 3: 最初のタスクを記録

タスク実施時に:

1. **指示を出す前**: テンプレートをコピー
   ```bash
   cp docs/templates/instruction_template.md docs/instructions/20251208_my_first_task.md
   ```

2. **タスク実施中**: 各Phaseの結果を記録

3. **タスク完了後**: cost.csv に1行追加
   ```csv
   2025-12-08,最初のタスク,Task tool,50000,1.0,5,0.33,Explore+実装
   ```

---

## 📋 便利なテンプレート集

### 新機能追加の指示履歴テンプレート

```markdown
# [機能名]追加 - 指示履歴

## 📋 基本情報
- **日時**: YYYY-MM-DD HH:MM - HH:MM
- **目的**: [機能名]を追加
- **関連Issue**: #XXX

## 🎯 最終ゴール
[機能の詳細説明]

## 📊 定量目標
- 所要時間: X時間以内
- トークン消費: XXK以内

## 🔄 作業フロー

### Phase 1: 探索（HH:MM - HH:MM）
**指示内容**: [探索指示]
**実行結果**: [結果]
**振り返り**: [Keep/Problem/Try]

### Phase 2: 計画（HH:MM - HH:MM）
**指示内容**: [計画指示]
**実行結果**: [結果]
**承認**: ✅/❌

### Phase 3: 実装（HH:MM - HH:MM）
**指示内容**: [実装指示]
**実行結果**: [結果]

### Phase 4: 検証（HH:MM - HH:MM）
**指示内容**: [検証指示]
**実行結果**: [結果]

## 📊 定量結果
[実績データ]

## 💡 学びと改善点
### Keep: [継続すること]
### Problem: [改善が必要だったこと]
### Try: [次回への改善策]
```

---

### バグ修正の指示履歴テンプレート

```markdown
# [バグ名]修正 - 指示履歴

## 📋 基本情報
- **日時**: YYYY-MM-DD HH:MM - HH:MM
- **バグ内容**: [バグの説明]
- **関連Issue**: #XXX

## 🎯 最終ゴール
[バグ修正のゴール]

## 🐛 バグの詳細
- **発生箇所**: [ファイルパス:行番号]
- **再現手順**: [手順]
- **原因**: [原因]

## 🔄 修正フロー

### Step 1: 原因調査（HH:MM - HH:MM）
**指示内容**: [調査指示]
**実行結果**: [結果]

### Step 2: 修正実装（HH:MM - HH:MM）
**指示内容**: [修正指示]
**実行結果**: [結果]

### Step 3: 確認（HH:MM - HH:MM）
**指示内容**: [確認指示]
**実行結果**: [結果]

## 📊 定量結果
- 所要時間: X分
- トークン消費: XK
- コスト: $X.XX

## 💡 学びと改善点
### 根本原因: [なぜ起きたか]
### 再発防止: [どうすれば防げるか]
```

---

## 🎓 まとめ

### 記録することで得られる3つの価値

1. **再現性の向上**
   - 成功パターンをコピペで再利用
   - 「前回どうやったっけ？」を防ぐ

2. **効果の検証**
   - トークン消費、時間、バグ数を定量的に把握
   - 改善の効果を数字で示せる

3. **チーム内での共有**
   - 他の人が同じ失敗を繰り返さない
   - ベストプラクティスを共有

### 記録にかかるコスト

- **タスクあたり**: 5-10分
  - 指示履歴: 3-5分
  - cost.csv追記: 1分
  - 週次レビュー: 10-15分/週

- **効果**:
  - 次回以降の効率が **30%向上**
  - トラブル時の解決時間が **50%短縮**

### 記録のベストプラクティス

1. **タスク開始時**: テンプレートをコピー
2. **タスク実施中**: 各Phaseの結果を記録（リアルタイム）
3. **タスク完了後**: cost.csv に追記
4. **週末**: 週次レビューを作成

---

**このガイドの更新ルール**:
- 新しいテンプレートが必要になったら追加
- 記録方法で改善点があったら反映

**次回レビュー**: 月次